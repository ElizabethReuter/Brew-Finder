<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1</title>
    <!-- Compressed CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <!-- maps -->
    <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"/>
</head>
<header>
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://bulma.io">
        <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
      </a>
  
      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
  
    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item">
          Home
        </a>
  
        <a class="navbar-item">
          Documentation
        </a>
  
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            More
          </a>
  
          <div class="navbar-dropdown">
            <a class="navbar-item">
              About
            </a>
            <a class="navbar-item">
              Jobs
            </a>
            <a class="navbar-item">
              Contact
            </a>
            <hr class="navbar-divider">
            <a class="navbar-item">
              Report an issue
            </a>
          </div>
        </div>
      </div>
  
      <div class="navbar-end">
        <div class="navbar-item">
          <div class="buttons">
            <a class="button is-primary">
              <strong>Sign up</strong>
            </a>
            <a class="button is-light">
              Log in
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <hr>

</header>
<body class="body">
<div class="row h-100">
  <div class="column card col-md-6 col-lg-6 mb-4">
    <div class="card">
      <header class="card-header">
       <p class="card-header-title">
         Brewery finder
        </p>
      </header>
      <div class="card-content cityCard">
        <div class="content">
         <label>Input City</label>
         <input type="text" placeholder="Enter City" id="userInput"> 
         <button id="btn">Find!</button>
          <br>
        </div>
      </div>
    </div>
  </div>
    <div class="column card col-md-6 col-lg-6 mb-4">
      <div class="card">
        <header class="card-header">
         <p class="card-header-title">
           MapQuest
          </p>
        </header>
        <div class="card-content mapCard">
          <div class="mapPlace">
          </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="listContainer">
    <div class="col-md-12">
      <div id="bar-div">

      </div>
    </div>
  </div>
</div>
<footer>
  <div class="footer-bottom">
     footer
  </div>
</footer>
<script>
   $(document).ready(function () {
                var barArr = [];
                var map

                $("#btn").on("click", function () {
                  console.log("button WORKS");
                    $('#bar-div').empty()
                    $('#map').remove()
                    $('.mapPlace').append('<div id="map" style="width: 300px; height: 300px;"></div>')
                    var userInput = $("#userInput").val().trim();
                    getBarInfo(userInput);
                });

                function getBarInfo(z) {
                    console.log('about to smack api with this city', z)
                    barArr = [];
                    var city = z;
                    var queryURL = "https://api.openbrewerydb.org/breweries?by_city=" + city;
                    $.ajax({url: queryURL, method: "GET"}).then(function (response) {
                        console.log(response);
                        for (var i = 0; i < response.length; i++) {
                            if (response[i].longitude != null && response[i].latitude != null) {
                                var barName = response[i].name;
                                var barLong = response[i].longitude;
                                var barLat = response[i].latitude;
                                barArr.push({barName, barLong, barLat});
                            }

                        }
                        console.log('barArray inside .then onf ajax', barArr);
                        displayMap();
                        displayBars();
                    })
                }

                function displayBars() {
                    console.log('theres are barrArr in the display bars function', barArr)
                    for (var i = 0; i < barArr.length; i++) {
                        var grabBarName = barArr[i].barName;
                        newDiv = $("<h4>").text(grabBarName);
                        $("#bar-div").append(newDiv);
                    }
                }

                function displayMap() {
                    console.log('inside display map!!', L)
                    L.mapquest.key = 'lYrP4vF3Uk5zgTiGGuEzQGwGIVDGuy24';

                    console.log('barrArr[0] we use this for map', barArr[0])

                    map = L.mapquest.map('map', {
                        center: [
                            barArr[0].barLat,
                            barArr[0].barLong
                        ],
                        layers: L.mapquest.tileLayer('map'),
                        zoom: 8
                    });

                    console.log('this is the map variable', map)
                    console.log('barr arr in display map function', barArr)
                    for (var i = 0; i < barArr.length; i++) {
                        if (barArr[i].barLat != null && barArr[i].barLong != null) {
                            L.marker([
                                barArr[i].barLat,
                                barArr[i].barLong
                            ], {
                                icon: L.mapquest.icons.marker(),
                                draggable: false
                            }).bindPopup(barArr[i].barName).addTo(map);
                        }
                    }
                };
            });

</script>
<script src="script.js"></script>
</body>
</html>